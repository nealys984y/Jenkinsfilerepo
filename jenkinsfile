pipeline {
  agent any

  environment {
    REPO_URL = 'https://github.com/nealys984y/docker.git'
    REPO_BRANCH = 'master' // or any other branch you want to checkout
    DOCKER_IMAGE_NAME = 'ys984y/docker_training'
  }

stages {
  stage('Checkout Code') {
    steps {
      script {
        checkout([$class: 'GitSCM',
          branches: [[name: REPO_BRANCH]],
          userRemoteConfigs: [[
            url: REPO_URL
          ]]
        ])
      }
    }
  }

  stage('Build Docker Image') {
    steps {
      script {
        app = docker.build("${DOCKER_IMAGE_NAME}")
      }
    }
   }

  stage('Test image') {
    steps {
      script {
       app.inside {
            sh """ echo 'Tests passed'
               """
        }

      }
    }
  }

  stage('Push image') {
    steps {
      script{  
        docker.withRegistry('https://registry.hub.docker.com', 'docker-hub') {
            app.push("${env.BUILD_NUMBER}")
            app.push("latest")
        }
      }
    }
   }
  }

}
